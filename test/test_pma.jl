@testset "PMA" begin

function factorizationcmp(F1,F2)
	@test size(F1.U)==size(F2.U)
	@test size(F1.S)==size(F2.S)
	@test size(F1.V)==size(F2.V)
	@test F1.S ≈ F2.S
	sgn = sign.(diag(F1.U'F2.U))
	@test F1.U.*sgn' ≈ F2.U
	@test F1.V.*sgn' ≈ F2.V
	nothing
end

extractdims(F::SVD,dims) = SVD(F.U[:,dims], F.S[dims], F.Vt[dims,:])

A = [-8 0 6 0 0 0; -1 9 6 -2 0 -1; -1 0 -2 0 0 0; 0 1 0 1 0 -2; -9 -3 0 0 0 -5; -6 3 -8 -2 -4 8; 0 -1 -1 0 -3 -1; 4 0 0 -6 0 2]

@testset "PCA" begin
	FAns = svd(A)
	FPMA = pma(A,I(6); nsv=6)
	factorizationcmp(FAns,FPMA)
	FPMA4 = pma(A,I(6); nsv=4)
	factorizationcmp(extractdims(FAns,1:4),FPMA4)
end

@testset "SampleGraph1" begin
	G = Bool[1 0 0 0 0 0; 0 1 1 0 0 0; 0 1 1 0 0 0; 0 0 0 1 1 1; 0 0 0 1 1 1; 0 0 0 1 1 1]
	# Steps by which the test answer was produced
	# S = [1 0 0 0 0 0; 0 2/3 1/3 0 0 0; 0 1/3 2/3 0 0 0; 0 0 0 1/2 1/4 1/4; 0 0 0 1/4 1/2 1/4; 0 0 0 1/4 1/4 1/2]
	# a,b,c,d = 1/2+sqrt(1/12), 1/2-sqrt(1/12), 2/3, 1/6
	# Ssq = [1 0 0 0 0 0; 0 a b 0 0 0; 0 b a 0 0 0; 0 0 0 c d d; 0 0 0 d c d; 0 0 0 d d c ]
	# F = svd(A*Ssq)
	# FVt = (F.U'A)./F.S
	# FAns = SVD(F.U, F.S, FVt)
	FAns = SVD([-0.5849093067212429 -0.30459676132964564 0.09995016016115275 0.22592097498694638 -0.5733870519528862 0.28787541529391975; -0.1269329289658206 -0.8261023049743168 -0.3488295083486167 -0.2202594293176795 0.3035581016515436 -0.08500092198010664; -0.062122787597294456 0.12334841262286848 -0.043273938496292096 -0.04167125011884289 0.15202006216734681 -0.24922681385148573; -0.007824749739116652 -0.0635552378463148 0.05637595932684848 -0.05524887783350317 0.3780093342748796 -0.03724191701916846; -0.637374151934111 0.16301150870907877 0.43020431218705285 -0.4279300455010361 0.18224681732796086 -0.3342110723650221; -0.39230426237313987 0.4094718281219207 -0.8109258824259621 -0.057701021576176764 0.018007322541337606 0.024679166666852617; -0.008412657215166462 0.09932831378346374 0.08961225335823861 -0.45173592533115325 0.22952754394584904 0.8341658487895257; 0.27862062087436223 -0.03762514628733902 -0.11211674309137805 -0.7107303900221393 -0.5717145721014071 -0.1956089414126082],
	           [14.167212037913885, 12.535186854224468, 7.122216100999877, 4.560411914541694, 3.0062432871794105, 1.6119478531016858],
	           [0.9933503894636836 -0.02869998581550796 -0.07058277098214098 -0.04525054686777788 0.1125454335596181 0.05341015480451583; -0.07458262570365305 -0.5471337139141851 -0.8301427240648933 0.07941298403916762 -0.1544350536095653 0.25842065965271876; 0.0193411258671486 -0.9682509425738784 0.7007743830205561 0.4280391322296846 0.41768836095993994 -1.2238040304569504; -0.041834409951626815 -0.10419250574092923 0.22600060948604722 1.044873676628379 0.34777820337695425 0.227846607858832; 0.032064827424309626 0.7942757763538758 -0.763943477300558 1.0528641949891078 -0.2530107677068735 -1.064354631012308; 0.06738015681145812 -0.34724780051474763 0.4243942532912374 0.779836171290642 -1.6137086618718903 0.4979005480973234])

	FPMA = pma(A,G; nsv=6)
	factorizationcmp(FAns,FPMA)

	FPMA4 = pma(A,G; nsv=4)
	factorizationcmp(extractdims(FAns,1:4),FPMA4)
end

end
