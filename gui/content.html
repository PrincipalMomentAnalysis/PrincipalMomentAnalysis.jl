<script type="text/javascript">
    function getChecked(groupName) {
        var g = document.getElementById(groupName).getElementsByTagName("input");
        for(var i = 0; i < g.length; i++){
            if(g[i].checked) {
                return g[i].value;
            }
        }
        return "";
    }
    function updateSampleSimplexMethod(method) {
        setValue("samplesimplexmethod", method)

        document.getElementById("sampleAnnot").disabled = method=="NN"
        document.getElementById("timeAnnot").disabled = method!="Time"
        enabled = method=="NN" || method=="NNSA"
        document.getElementById("kNearestNeighbors").disabled = !enabled
        document.getElementById("distNearestNeighbors").disabled = !enabled
    }
    function sendMessage(data) {
        Blink.msg("msg", data)
    }
    function setValue(name, value) {
        // Blink.msg("msg",["setvalue", name, value])
        sendMessage(["setvalue", name, value])
    }
    function init() {
        updateSampleSimplexMethod("SA");
        setValue("loadnbrsampleannots", document.getElementById("loadNbrSampleAnnots").value);
        setValue("loadrowsassamples",        document.getElementById("loadRowsAsSamples").checked.toString());
        setValue("normalizemethod",          getChecked("normalizeMethodGroup"));
        setValue("dimreductionmethod",       getChecked("dimReductionMethodGroup"));
        setValue("knearestneighbors",        document.getElementById("kNearestNeighbors").value);
        setValue("distnearestneighbors",     document.getElementById("distNearestNeighbors").value);
        setValue("plotdims",                 getChecked("plotDimsGroup"));
        setValue("plotwidth",                document.getElementById("plotWidth").value);
        setValue("plotheight",               document.getElementById("plotHeight").value);
        setValue("markersize",               document.getElementById("markerSize").value);
        setValue("showpoints",               document.getElementById("showPoints").checked.toString());
        setValue("showlines",                document.getElementById("showLines").checked.toString());
        setValue("showtriangles",            document.getElementById("showTriangles").checked.toString());
    }
    function setSampleStatus(status) {
        document.getElementById("info").innerHTML = status;
    }
    function setDropDownItems(id, v) {
        var dropdown = document.getElementById(id);
        var val
        if (v.includes(dropdown.value)) {
            val = dropdown.value;
        }
        dropdown.options.length = 0;
        for(var i = 0; i < v.length; i++) {
            var opt = document.createElement("option");
            opt.value = v[i];
            opt.text = v[i];
            dropdown.options.add(opt);
        }
        if (val===undefined && v.length>0) {
            val = v[0]
        }
        dropdown.value = val;
    }
    function setSampleAnnotNames(v) {
        setDropDownItems("sampleAnnot", v);
        setValue("sampleannot", document.getElementById("sampleAnnot").value)
        setDropDownItems("timeAnnot", v);
        setValue("timeannot", document.getElementById("timeAnnot").value)
    }
</script>
<style>
    .group {
        border: 1px solid gray;
        margin: 1px;
        padding: 4px;
    }
    .subtitle {
        text-align: center;
        font-weight: bold;
    }
</style>
<div>
    <div class="group">
        <p class="subtitle">Samples</p>
        Number of sample annotations: <input type="number" id="loadNbrSampleAnnots" min="0" max="10000" value="1" onchange='setValue("loadnbrsampleannots",this.value)'><br>
        Use rows as samples <input type="checkbox" id="loadRowsAsSamples" onclick='setValue("loadrowsassamples", this.checked.toString())' checked><br>
        <button onclick='var electron = require("electron"); var fp = electron.remote.dialog.showOpenDialog({properties: ["openFile"]}); if (!(fp===undefined)) { setValue("samplefilepath", fp[0]); sendMessage(["loadsample"]); }'>Load sample</button>
        <div class="group">
            <p id="info"></p>
        </div>
    </div>
    <div class="group">
        <p class="subtitle">Normalize</p>
        <p id="normalizeMethodGroup">
            <input type="radio" name="normalizemethodgroup" value="None"         onclick='setValue("normalizemethod", "None")'                >None
            <input type="radio" name="normalizemethodgroup" value="Mean=0"       onclick='setValue("normalizemethod", "Mean=0")'       checked>Mean=0
            <input type="radio" name="normalizemethodgroup" value="Mean=0,Std=1" onclick='setValue("normalizemethod", "Mean=0,Std=1")'        >Mean=0,Std=1
        </p>
    </div>
    <div class="group">
        <p class="subtitle">Parameters</p>
        <div id="dimReductionMethodGroup">
            <p>
                Dimension Reduction:
                <input type="radio" name="dimreductionmethodgroup" value="PMA" onclick='setValue("dimreductionmethod", "PMA")' checked>PMA
                <input type="radio" name="dimreductionmethodgroup" value="PCA" onclick='setValue("dimreductionmethod", "PCA")'        >PCA
            </p>
        </div>
        <div id="sampleMethodGroup">
            <p>Sample Simplex Method:</p>
            <input type="radio" name="samplemethod" value="SA"   onclick='updateSampleSimplexMethod("SA")'   checked>Sample Annotation<br>
            <input type="radio" name="samplemethod" value="Time" onclick='updateSampleSimplexMethod("Time")'        >Time Series<br>
            <input type="radio" name="samplemethod" value="NN"   onclick='updateSampleSimplexMethod("NN")'          >Nearest Neighbor<br>
            <input type="radio" name="samplemethod" value="NNSA" onclick='updateSampleSimplexMethod("NNSA")'        >Nearest Neighbor within groups<br>
        </div>
        <div>
            <p>Choose sample annotation:</p>
            <select id="sampleAnnot" onchange='setValue("sampleannot",this.value)'></select>
            <p>Choose time annotation:</p>
            <select id="timeAnnot" onchange='setValue("timeannot",this.value)'></select>
            <p>Number of Nearest Neighbors:</p>
            <input type="number" id="kNearestNeighbors" min="0" max="1000000" value="0" onchange='setValue("knearestneighbors",this.value)'>
            <p>Nearest Neighbors distance:</p>
            <input type="range" id="distNearestNeighbors" min="0" max="1" step="0.001" value="0" onchange='setValue("distnearestneighbors",this.value)'> </div>
    </div>
    <div class="group">
        <p class="subtitle">Plot</p>
        <div id="plotDimsGroup">
            <p>
                Plot dimension:
                    <!-- <input type="radio" name="plotdims" value="2"        >2 -->
                    <input type="radio" name="plotdims" value="3" onclick='setValue("plotdims", "3")' checked>3
            </p>
            <p>
                Plot width: <input type="number" id="plotWidth"  min="0" max="10000" value="1024" onchange='setValue("plotwidth",this.value)'>
                height:     <input type="number" id="plotHeight" min="0" max="10000" value="768"  onchange='setValue("plotheight",this.value)'>
            </p>
            <p>
                Marker size: <input type="number" id="markerSize"  min="0" max="100" value="4" step="0.01" onchange='setValue("markersize",this.value)'>
            </p>
            <p>
                Show points: <input type="checkbox" id="showPoints"    onclick='setValue("showpoints",   this.checked.toString())' checked>
                lines:       <input type="checkbox" id="showLines"     onclick='setValue("showlines",    this.checked.toString())'        >
                triangles:   <input type="checkbox" id="showTriangles" onclick='setValue("showtriangles",this.checked.toString())'        >
            </p>
        </div>
        <button onclick='sendMessage(["showplot"])'>Show plot</button>
    </div>
    <div class="group" align="center">
        <button onclick='sendMessage(["cancel"])'>Cancel processing</button>
    </div>
</div>
